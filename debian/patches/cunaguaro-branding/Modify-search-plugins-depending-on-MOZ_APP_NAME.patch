From: Mike Hommey <mh@glandium.org>
Date: Sat, 19 Feb 2011 11:04:53 +0100
Subject: Modify search plugins depending on MOZ_APP_NAME

---
 browser/locales/Makefile.in                     |    9 +++++++--
 browser/locales/en-US/searchplugins/answers.xml |    2 +-
 browser/locales/en-US/searchplugins/google.xml  |    6 +++++-
 3 files changed, 13 insertions(+), 4 deletions(-)

Index: cunaguaro-8.0-1/browser/locales/Makefile.in
===================================================================
--- cunaguaro-8.0-1.orig/browser/locales/Makefile.in	2012-05-11 11:40:17.000000000 -0430
+++ cunaguaro-8.0-1/browser/locales/Makefile.in	2012-05-11 11:40:32.455402752 -0430
@@ -162,8 +162,13 @@
 
 SEARCH_PLUGINS = $(shell cat $(call MERGE_FILE,/searchplugins/list.txt))
 
-libs:: $(addsuffix .xml,$(SEARCH_PLUGINS))
-	$(SYSINSTALL) $(IFLAGS1) $^ $(FINAL_TARGET)/searchplugins
+$(FINAL_TARGET)/searchplugins/%: %
+	$(SYSINSTALL) -D $(dir $@)
+	$(PYTHON) $(topsrcdir)/config/Preprocessor.py \
+	  -DMOZ_APP_NAME=$(MOZ_APP_NAME) \
+	  $< > $@
+
+libs:: $(addprefix $(FINAL_TARGET)/searchplugins/,$(addsuffix .xml,$(SEARCH_PLUGINS)))
 
 install:: $(addsuffix .xml,$(SEARCH_PLUGINS))
 	$(SYSINSTALL) $(IFLAGS1) $^ $(DESTDIR)$(mozappdir)/searchplugins
Index: cunaguaro-8.0-1/browser/locales/en-US/searchplugins/google.xml
===================================================================
--- cunaguaro-8.0-1.orig/browser/locales/en-US/searchplugins/google.xml	2012-05-11 09:34:17.000000000 -0430
+++ cunaguaro-8.0-1/browser/locales/en-US/searchplugins/google.xml	2012-05-11 11:40:32.455402752 -0430
@@ -3,7 +3,11 @@
 <Description>Google Search</Description>
 <InputEncoding>UTF-8</InputEncoding>
 <Image width="16" height="16" type="image/x-icon">http://www.google.com/favicon.ico</Image>
+#if MOZ_APP_NAME==firefox
 <Url type="application/x-suggestions+json" method="GET" template="http://suggestqueries.google.com/complete/search?output=firefox&amp;client=firefox&amp;hl={moz:locale}&amp;q={searchTerms}"/>
+#else
+<Url type="application/x-suggestions+json" method="GET" template="http://suggestqueries.google.com/complete/search?output=firefox&amp;hl={moz:locale}&amp;q={searchTerms}"/>
+#endif
 <Url type="text/html" method="GET" template="http://www.google.com/search">
   <Param name="q" value="{searchTerms}"/>
   <Param name="ie" value="utf-8"/>
@@ -11,7 +15,7 @@
   <Param name="aq" value="t"/>
   <!-- Dynamic parameters -->
   <Param name="rls" value="{moz:distributionID}:{moz:locale}:{moz:official}"/>
-  <MozParam name="client" condition="defaultEngine" trueValue="firefox-a" falseValue="firefox"/>
+#expand  <MozParam name="client" condition="defaultEngine" trueValue="__MOZ_APP_NAME__-a" falseValue="__MOZ_APP_NAME__"/>
 </Url>
 <SearchForm>http://www.google.com/</SearchForm>
 </SearchPlugin>
